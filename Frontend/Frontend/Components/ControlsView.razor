@using Audio
<MudItem style="position: fixed; bottom: 10px; right: 20px" xs="12" md="1">
    <MudRadioGroup T="Guid"
        Value="@SelectedPlaylistId"
        Class="playlist-selection"
        ValueChanged="@(EventCallback.Factory.Create<Guid>(this, value => OnTargetPlaylistChanged(value)))">
        @foreach (var playlist in Playlists.Values)
        {
            <MudRadio T="Guid" Color="Color.Primary" Value="@playlist.Id">@playlist.Name</MudRadio>
        }
    </MudRadioGroup>
</MudItem>

<MudSlider
    Size="Size.Large"
    Value="@State.Volume.Value"
    Vertical="true"
    Class="slider-bottom-left"
    ValueChanged="@(EventCallback.Factory.Create<double>(this, (value) => OnVolumeSlider(value)))">
</MudSlider>

<MudFab
    Style="position: fixed; bottom: 80px; right: 10px"
    Color="Color.Primary"
    StartIcon="@Icons.Material.Filled.ArrowForward"
    OnClick="@(() => State.RequestSkip())"/>

<style>
    .slider-bottom-left.mud-slider.mud-slider-vertical {
        height: auto !important;
        position: fixed;
        bottom: 250px;
        right: -60px;
        width: 200px;
    }

    .mud-grid-item-md-1 {
        max-width: 10000px !important;
    }
</style>

@code {
    [Parameter] public SessionState State { get; set; }
    [Inject] public IPlaylistsCollection Playlists { get; set; }

    private Guid SelectedPlaylistId { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();

        var firstPlaylist = Playlists.Values.FirstOrDefault()!;

        SelectedPlaylistId = firstPlaylist.Id;
        State.SetPlaylist(firstPlaylist);
    }

    private void OnVolumeSlider(double value)
    {
        State.SetVolume(value);
    }

    private void OnTargetPlaylistChanged(Guid? playlistId)
    {
        if (Playlists.TryGetValue(playlistId!.Value, out var playlist))
        {
            SelectedPlaylistId = playlistId.Value;
            State.SetPlaylist(playlist);
        }
    }

}